let usdToKztRate = 0;
const keyToUsdRate = 2.4;

async function fetchUsdToKztRate() {
  try {
    const response = await fetch('https://hexarate.paikama.co/api/rates/latest/USD?target=KZT');
    const data = await response.json();
    if (data && data.rates && data.rates.KZT) {
      usdToKztRate = data.rates.KZT;
      console.log('Курс USD → KZT:', usdToKztRate);
    } else {
      throw new Error('Неверный формат данных');
    }
  } catch (error) {
    document.getElementById("result").innerText = "Ошибка загрузки курса USD → KZT.";
    console.error("Ошибка API:", error);
  }
}

async function convertCurrency() {
  const amount = parseFloat(document.getElementById("amount").value);
  const from = document.getElementById("fromCurrency").value;
  const to = document.getElementById("toCurrency").value;

  if (isNaN(amount)) {
    document.getElementById("result").innerText = "Введите корректную сумму.";
    return;
  }

  if (!usdToKztRate) {
    await fetchUsdToKztRate();
  }

  let usdAmount;

  // Конвертация из исходной валюты в USD
  if (from === "USD") usdAmount = amount;
  else if (from === "KZT") usdAmount = amount / usdToKztRate;
  else if (from === "KEY") usdAmount = amount * keyToUsdRate;

  let result;

  // Конвертация из USD в целевую валюту
  if (to === "USD") result = usdAmount;
  else if (to === "KZT") result = usdAmount * usdToKztRate;
  else if (to === "KEY") result = usdAmount / keyToUsdRate;

  document.getElementById("result").innerText = `Результат: ${result.toFixed(2)} ${to}`;
}

fetchUsdToKztRate();
